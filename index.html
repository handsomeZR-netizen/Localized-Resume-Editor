<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>个人简历 | PDF 终极修复版</title>
    
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 html2pdf.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <style>
        /* 交互样式 */
        [contenteditable="true"]:focus {
            outline: 2px solid #3b82f6;
            background-color: rgba(239, 246, 255, 0.5);
            border-radius: 4px;
            padding: 2px;
        }
        
        [contenteditable="true"]:hover {
            background-color: rgba(243, 244, 246, 0.5);
            cursor: text;
            border-radius: 4px;
        }

        .expand-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-out, opacity 0.4s ease;
            opacity: 0;
        }
        .expand-content.active {
            opacity: 1;
        }
        
        .html2pdf__page-break {
            page-break-before: always;
        }

        .delete-btn {
            opacity: 0;
            transition: opacity 0.2s;
        }
        .group:hover .delete-btn {
            opacity: 1;
        }

        .tag-delete {
            display: none;
        }
        .skill-tag:hover .tag-delete {
            display: inline-block;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans text-gray-700 leading-relaxed">

    <!-- 顶部提示条 -->
    <div id="toolbar" class="bg-slate-800 text-white py-3 px-6 text-center shadow-md sticky top-0 z-50">
        <p class="text-sm md:text-base flex items-center justify-center gap-2 flex-wrap">
            <!-- Icon 修复：添加 style 确保不被压缩 -->
            <svg style="width: 20px; height: 20px; min-width: 20px;" class="text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg>
            <span>提示：<strong>点击头像</strong>可上传图片。点击文字编辑，悬停项目可删除。</span>
        </p>
    </div>

    <!-- 整体容器 -->
    <div id="resume-container" class="max-w-6xl mx-auto my-4 md:my-10 bg-white shadow-2xl rounded-xl overflow-hidden flex flex-col md:flex-row min-h-[1000px]">

        <!-- 左侧边栏 -->
        <aside class="w-full md:w-1/3 lg:w-1/4 bg-slate-50 border-r border-gray-100 p-8 flex flex-col">
            
            <!-- 头像部分：终极修复 -->
            <div class="text-center md:text-left mb-8">
                <div class="w-32 h-32 mx-auto md:mx-0 rounded-full overflow-hidden border-4 border-white shadow-lg mb-4 relative group cursor-pointer" onclick="document.getElementById('avatar-upload').click()">
                    <!-- 
                         修复要点：
                         1. 使用 PNG 格式 (notionists/png) 替代 SVG，html2canvas 对 PNG 支持更好。
                         2. 显式内联样式 background-size: cover，确保填充整个圆。
                    -->
                    <div id="avatar-bg" class="w-full h-full bg-cover bg-center transition duration-300 group-hover:opacity-75" 
                         style="background-image: url('https://api.dicebear.com/7.x/notionists/png?seed=Felix&backgroundColor=e5e7eb'); background-size: cover; background-position: center; background-repeat: no-repeat;">
                    </div>
                    
                    <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition duration-300">
                        <div class="bg-black bg-opacity-50 text-white text-xs py-1 px-2 rounded">
                            点击更换
                        </div>
                    </div>
                    
                    <input type="file" id="avatar-upload" class="hidden" accept="image/*" onchange="uploadAvatar(this)">
                </div>

                <h1 contenteditable="true" class="text-2xl font-bold text-slate-800">徐子锐</h1>
                <p contenteditable="true" class="text-blue-600 font-medium mt-1">求职意向：产品经理</p>
                <p contenteditable="true" class="text-sm text-gray-500 mt-2">写一段简短的个人简介，例如：3年产品经验，设计狂热者，擅长数据分析与用户体验优化。</p>
            </div>

            <!-- 联系方式：Icon 修复 (添加 inline style min-width) -->
            <div class="space-y-3 text-sm mb-8">
                <div class="flex items-center gap-3">
                    <svg style="width: 20px; height: 20px; min-width: 20px;" class="text-blue-500 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                    <span contenteditable="true" class="hover:text-blue-600 transition">xxx@xxxx.com</span>
                </div>
                <div class="flex items-center gap-3">
                    <svg style="width: 20px; height: 20px; min-width: 20px;" class="text-blue-500 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path></svg>
                    <span contenteditable="true">188-8888-8888</span>
                </div>
                <div class="flex items-center gap-3">
                    <svg style="width: 20px; height: 20px; min-width: 20px;" class="text-blue-500 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                    <span contenteditable="true">浙江 · 杭州</span>
                </div>
                <div class="flex items-center gap-3">
                    <svg style="width: 20px; height: 20px; min-width: 20px;" class="text-blue-500 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"></path></svg>
                    <span contenteditable="true">个人主页/作品集链接</span>
                </div>
            </div>

            <nav class="hidden md:block flex-1">
                <ul class="space-y-4 font-medium text-slate-600">
                    <li><a href="#education" class="flex items-center gap-3 hover:text-blue-600 transition group"><span class="text-slate-400">•</span> 教育经历</a></li>
                    <li><a href="#awards" class="flex items-center gap-3 hover:text-blue-600 transition group"><span class="text-slate-400">•</span> 获奖经历</a></li>
                    <li><a href="#experience" class="flex items-center gap-3 hover:text-blue-600 transition group"><span class="text-slate-400">•</span> 工作/项目经历</a></li>
                    <li><a href="#skills" class="flex items-center gap-3 hover:text-blue-600 transition group"><span class="text-slate-400">•</span> 个人技能</a></li>
                </ul>
            </nav>
        </aside>

        <!-- 右侧主要内容区域 -->
        <main class="flex-1 p-6 md:p-10">
            
            <!-- 1. 教育经历 -->
            <section id="education" class="mb-10">
                <div class="flex items-center gap-3 mb-6 pb-2 border-b border-gray-200">
                    <div class="bg-blue-100 p-2 rounded-lg text-blue-600">
                        <svg style="width: 24px; height: 24px; min-width: 24px;" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M12 14l9-5-9-5-9 5 9 5z"></path><path d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l9-5-9-5-9 5 9 5zm0 0l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14zm-4 6v-7.5l4-2.222"></path></svg>
                    </div>
                    <h2 class="text-xl font-bold text-slate-800">教育经历</h2>
                </div>
                
                <div class="flex flex-col md:flex-row justify-between md:items-center mb-2">
                    <div>
                        <h3 contenteditable="true" class="font-bold text-lg text-slate-800">浙江大学</h3>
                        <p contenteditable="true" class="text-gray-600">工业设计 / 硕士研究生在读</p>
                    </div>
                    <span contenteditable="true" class="text-sm text-gray-500 bg-gray-100 px-3 py-1 rounded-full mt-2 md:mt-0 w-fit">2020.09 - 至今</span>
                </div>
                <p contenteditable="true" class="text-sm text-gray-500 mt-2">主修课程：人机交互、用户体验设计、数据分析基础。</p>
            </section>

            <!-- 2. 获奖经历 -->
            <section id="awards" class="mb-10">
                <div class="flex items-center gap-3 mb-6 pb-2 border-b border-gray-200">
                    <div class="bg-yellow-100 p-2 rounded-lg text-yellow-600">
                        <svg style="width: 24px; height: 24px; min-width: 24px;" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path></svg>
                    </div>
                    <h2 class="text-xl font-bold text-slate-800">获奖经历</h2>
                </div>
                
                <ul id="awards-list" class="space-y-4">
                    <li class="group relative hover:bg-gray-50 p-2 rounded -mx-2 transition">
                        <button class="delete-btn no-pdf absolute top-2 right-2 text-red-400 hover:text-red-600 hover:bg-red-50 rounded p-1 transition" title="删除此项">
                            <svg style="width: 16px; height: 16px;" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                        </button>
                        <div class="flex justify-between items-start pr-8">
                            <div>
                                <h4 contenteditable="true" class="font-medium text-slate-800">江苏省「互联网+」大学生创新创业大赛 二等奖</h4>
                            </div>
                            <span contenteditable="true" class="text-sm text-gray-400 shrink-0">2019.06</span>
                        </div>
                    </li>
                </ul>

                <button onclick="addAward()" class="no-pdf mt-4 w-full py-2 border-2 border-dashed border-gray-300 rounded-lg text-gray-400 hover:text-blue-500 hover:border-blue-400 hover:bg-blue-50 transition flex items-center justify-center gap-2 group">
                    <svg style="width: 20px; height: 20px;" class="group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                    添加获奖经历
                </button>
            </section>

            <!-- 3. 工作/项目经历 -->
            <section id="experience" class="mb-10">
                <div class="flex items-center gap-3 mb-6 pb-2 border-b border-gray-200">
                    <div class="bg-purple-100 p-2 rounded-lg text-purple-600">
                        <svg style="width: 24px; height: 24px; min-width: 24px;" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                    </div>
                    <h2 class="text-xl font-bold text-slate-800">工作/项目经历</h2>
                </div>

                <div id="experience-list">
                    <article class="group relative mb-6 bg-white border border-gray-100 rounded-lg p-4 shadow-sm hover:shadow-md transition">
                        <button class="delete-btn no-pdf absolute top-4 right-4 text-red-400 hover:text-red-600 hover:bg-red-50 rounded p-1 transition z-10" title="删除此项">
                            <svg style="width: 16px; height: 16px;" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                        </button>

                        <div class="flex justify-between items-start mb-2 pr-6">
                            <div>
                                <h3 contenteditable="true" class="font-bold text-slate-800">某知名互联网公司 - 产品实习生</h3>
                                <p contenteditable="true" class="text-sm text-blue-600 font-medium">B端后台管理系统重构</p>
                            </div>
                            <span contenteditable="true" class="text-xs text-gray-400">2023.06 - 2023.09</span>
                        </div>
                        
                        <p contenteditable="true" class="text-sm text-gray-600 mb-3">
                            负责内部CRM系统的用户体验优化，通过数据分析提升了销售团队15%的操作效率。
                        </p>

                        <div id="exp1" class="expand-content text-sm text-gray-600 bg-gray-50 rounded p-3 mb-2">
                            <ul class="list-disc pl-4 space-y-1">
                                <li contenteditable="true">调研了50+名内部销售人员，输出了详细的用户体验地图。</li>
                                <li contenteditable="true">通过埋点数据分析，发现并修复了3个关键转化漏斗的流失点。</li>
                            </ul>
                        </div>

                        <button data-target="exp1" class="toggle-btn no-pdf text-xs font-bold text-blue-500 hover:text-blue-700 flex items-center gap-1 focus:outline-none">
                            <span class="mr-1">展开详情</span>
                            <svg style="width: 12px; height: 12px;" class="transform transition-transform duration-300 icon-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>
                    </article>
                </div>

                <button onclick="addExperience()" class="no-pdf w-full py-3 border-2 border-dashed border-gray-300 rounded-lg text-gray-400 hover:text-blue-500 hover:border-blue-400 hover:bg-blue-50 transition flex items-center justify-center gap-2 group">
                    <svg style="width: 24px; height: 24px;" class="group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                    添加工作/项目经历
                </button>
            </section>

            <!-- 4. 个人技能 -->
            <section id="skills" class="mb-10">
                <div class="flex items-center gap-3 mb-6 pb-2 border-b border-gray-200">
                    <div class="bg-green-100 p-2 rounded-lg text-green-600">
                        <svg style="width: 24px; height: 24px; min-width: 24px;" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                    </div>
                    <h2 class="text-xl font-bold text-slate-800">个人技能</h2>
                </div>

                <div id="skills-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    
                    <!-- 语言水平 -->
                    <div class="bg-slate-50 p-4 rounded-lg group/card relative hover:shadow-md transition">
                        <h3 contenteditable="true" class="font-bold text-slate-700 mb-3 flex items-center gap-2">
                            <svg style="width: 20px; height: 20px; min-width: 20px;" class="text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.204 8.844a10.09 10.09 0 01-2.418 2.938m0 0A9.935 9.935 0 0012 14.592m-6.368 3.368c1.069-.944 1.974-2.062 2.65-3.317m0 0a14.865 14.865 0 004.458-6.668m-4.458 6.668c-1.558-3.672-3.64-7.018-6.018-9.92"></path></svg>
                            语言水平
                        </h3>
                        <div id="language-list" class="space-y-3">
                            <div class="group/item relative">
                                <button class="delete-btn no-pdf absolute -right-2 top-0 text-red-400 hover:text-red-600" title="删除"><svg style="width: 16px; height: 16px;" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>
                                <div class="flex justify-between text-sm mb-1">
                                    <span contenteditable="true">英语 (CET-6)</span>
                                    <span contenteditable="true" class="font-bold text-blue-600">580分</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="bg-blue-500 h-2 rounded-full" style="width: 85%"></div>
                                </div>
                            </div>
                        </div>
                        <button onclick="addSkillBar(this)" class="no-pdf mt-3 text-xs text-blue-500 hover:text-blue-700 flex items-center gap-1"><svg style="width: 16px; height: 16px;" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg> 添加一项</button>
                    </div>

                    <!-- 软件技能 -->
                    <div class="bg-slate-50 p-4 rounded-lg group/card relative hover:shadow-md transition">
                        <h3 contenteditable="true" class="font-bold text-slate-700 mb-3 flex items-center gap-2">
                            <svg style="width: 20px; height: 20px; min-width: 20px;" class="text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg>
                            软件技能
                        </h3>
                        <div id="software-list" class="flex flex-wrap gap-2">
                            <span class="skill-tag group/tag relative px-3 py-1 bg-white border border-gray-200 rounded-full text-sm text-gray-600 shadow-sm">
                                <span contenteditable="true">Figma</span>
                                <button class="tag-delete no-pdf ml-1 text-red-400 hover:text-red-600 font-bold" title="删除">×</button>
                            </span>
                            <span class="skill-tag group/tag relative px-3 py-1 bg-white border border-gray-200 rounded-full text-sm text-gray-600 shadow-sm">
                                <span contenteditable="true">Python</span>
                                <button class="tag-delete no-pdf ml-1 text-red-400 hover:text-red-600 font-bold" title="删除">×</button>
                            </span>
                        </div>
                        <button onclick="addSkillTag(this)" class="no-pdf mt-3 text-xs text-purple-500 hover:text-purple-700 flex items-center gap-1"><svg style="width: 16px; height: 16px;" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg> 添加标签</button>
                    </div>

                </div>

                <button onclick="addNewSkillCategory()" class="no-pdf mt-4 w-full py-2 border-2 border-dashed border-gray-300 rounded-lg text-gray-400 hover:text-green-500 hover:border-green-400 hover:bg-green-50 transition flex items-center justify-center gap-2">
                    <svg style="width: 20px; height: 20px;" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    添加自定义技能板块 (如: 证书/爱好)
                </button>

            </section>

            <!-- 底部操作栏 -->
            <section id="footer-controls" class="mt-10 text-center border-t border-gray-200 pt-8 no-pdf">
                <button onclick="generatePDF()" class="bg-slate-800 text-white px-8 py-3 rounded-lg hover:bg-slate-700 transition shadow-lg hover:shadow-xl flex items-center justify-center gap-2 mx-auto text-lg font-bold">
                    <svg style="width: 20px; height: 20px;" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                    导出为 PDF
                </button>
                <p class="text-gray-400 text-sm mt-4">
                    &copy; 2025 徐子锐 - 编辑后点击上方按钮下载
                </p>
            </section>

        </main>
    </div>

    <script>
        // 工具：生成唯一ID
        function generateId() {
            return 'id-' + Math.random().toString(36).substr(2, 9);
        }

        // 1. 头像上传 (更新为修改 background-image)
        function uploadAvatar(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    // 这里修改 div 的 backgroundImage，而不是 img src
                    document.getElementById('avatar-bg').style.backgroundImage = 'url(' + e.target.result + ')';
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        // 2. 动态增删功能
        function addAward() {
            const list = document.getElementById('awards-list');
            const newItem = document.createElement('li');
            newItem.className = 'group relative hover:bg-gray-50 p-2 rounded -mx-2 transition';
            // 确保动态添加的 SVG 也有内联样式
            newItem.innerHTML = `
                <button class="delete-btn no-pdf absolute top-2 right-2 text-red-400 hover:text-red-600 hover:bg-red-50 rounded p-1 transition" title="删除此项">
                    <svg style="width: 16px; height: 16px;" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                </button>
                <div class="flex justify-between items-start pr-8">
                    <div>
                        <h4 contenteditable="true" class="font-medium text-slate-800">新奖项名称</h4>
                    </div>
                    <span contenteditable="true" class="text-sm text-gray-400 shrink-0">2024.01</span>
                </div>
            `;
            list.appendChild(newItem);
        }

        function addExperience() {
            const list = document.getElementById('experience-list');
            const uniqueId = generateId();
            const newItem = document.createElement('article');
            newItem.className = 'group relative mb-6 bg-white border border-gray-100 rounded-lg p-4 shadow-sm hover:shadow-md transition';
            newItem.innerHTML = `
                <button class="delete-btn no-pdf absolute top-4 right-4 text-red-400 hover:text-red-600 hover:bg-red-50 rounded p-1 transition z-10" title="删除此项">
                    <svg style="width: 16px; height: 16px;" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                </button>
                <div class="flex justify-between items-start mb-2 pr-6">
                    <div>
                        <h3 contenteditable="true" class="font-bold text-slate-800">公司 / 项目名称</h3>
                        <p contenteditable="true" class="text-sm text-blue-600 font-medium">职位</p>
                    </div>
                    <span contenteditable="true" class="text-xs text-gray-400">2024 - 至今</span>
                </div>
                <p contenteditable="true" class="text-sm text-gray-600 mb-3">项目简述...</p>
                <div id="${uniqueId}" class="expand-content text-sm text-gray-600 bg-gray-50 rounded p-3 mb-2">
                    <ul class="list-disc pl-4 space-y-1">
                        <li contenteditable="true">详细内容 1</li>
                    </ul>
                </div>
                <button data-target="${uniqueId}" class="toggle-btn no-pdf text-xs font-bold text-blue-500 hover:text-blue-700 flex items-center gap-1 focus:outline-none">
                    <span class="mr-1">展开详情</span>
                    <svg style="width: 12px; height: 12px;" class="transform transition-transform duration-300 icon-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </button>
            `;
            list.appendChild(newItem);
        }

        function addSkillBar(btn) {
            const container = btn.previousElementSibling;
            const newItem = document.createElement('div');
            newItem.className = 'group/item relative mt-3';
            newItem.innerHTML = `
                <button class="delete-btn no-pdf absolute -right-2 top-0 text-red-400 hover:text-red-600" title="删除"><svg style="width: 16px; height: 16px;" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>
                <div class="flex justify-between text-sm mb-1">
                    <span contenteditable="true">新技能</span>
                    <span contenteditable="true" class="font-bold text-blue-600">熟练度</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                    <div class="bg-blue-500 h-2 rounded-full" style="width: 50%"></div>
                </div>
            `;
            container.appendChild(newItem);
        }

        function addSkillTag(btn) {
            const container = btn.previousElementSibling;
            const newTag = document.createElement('span');
            newTag.className = 'skill-tag group/tag relative px-3 py-1 bg-white border border-gray-200 rounded-full text-sm text-gray-600 shadow-sm';
            newTag.innerHTML = `
                <span contenteditable="true">新标签</span>
                <button class="tag-delete no-pdf ml-1 text-red-400 hover:text-red-600 font-bold" title="删除">×</button>
            `;
            container.appendChild(newTag);
        }

        function addNewSkillCategory() {
            const grid = document.getElementById('skills-grid');
            const newCard = document.createElement('div');
            newCard.className = 'bg-slate-50 p-4 rounded-lg group/card relative hover:shadow-md transition';
            newCard.innerHTML = `
                <button class="delete-btn no-pdf absolute top-2 right-2 text-red-400 hover:text-red-600 hover:bg-red-50 rounded p-1" title="删除此板块">
                    <svg style="width: 16px; height: 16px;" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                </button>
                <h3 contenteditable="true" class="font-bold text-slate-700 mb-3 flex items-center gap-2">
                    <svg style="width: 20px; height: 20px;" class="text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                    自定义板块
                </h3>
                <div class="flex flex-wrap gap-2">
                    <span class="skill-tag group/tag relative px-3 py-1 bg-white border border-gray-200 rounded-full text-sm text-gray-600 shadow-sm">
                        <span contenteditable="true">内容1</span>
                        <button class="tag-delete no-pdf ml-1 text-red-400 hover:text-red-600 font-bold" title="删除">×</button>
                    </span>
                </div>
                <button onclick="addSkillTag(this)" class="no-pdf mt-3 text-xs text-gray-500 hover:text-gray-700 flex items-center gap-1"><svg style="width: 16px; height: 16px;" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg> 添加内容</button>
            `;
            grid.appendChild(newCard);
        }

        // 3. 事件委托
        document.addEventListener('click', function(e) {
            const toggleBtn = e.target.closest('.toggle-btn');
            if (toggleBtn) {
                const targetId = toggleBtn.getAttribute('data-target');
                const content = document.getElementById(targetId);
                const icon = toggleBtn.querySelector('.icon-arrow');
                const textSpan = toggleBtn.querySelector('span');
                if (content) {
                    if (content.style.maxHeight) {
                        content.style.maxHeight = null;
                        content.classList.remove('active');
                        textSpan.textContent = '展开详情';
                        icon.style.transform = 'rotate(0deg)';
                    } else {
                        content.style.maxHeight = content.scrollHeight + "px";
                        content.classList.add('active');
                        textSpan.textContent = '收起详情';
                        icon.style.transform = 'rotate(180deg)';
                    }
                }
                return;
            }
            const deleteBtn = e.target.closest('.delete-btn');
            if (deleteBtn) {
                if(confirm('确定要删除吗？')) {
                    const item = deleteBtn.closest('li') || deleteBtn.closest('article') || deleteBtn.closest('.group\\/item') || deleteBtn.closest('.group\\/card'); 
                    if (item) item.remove();
                }
                return;
            }
            const tagDeleteBtn = e.target.closest('.tag-delete');
            if (tagDeleteBtn) {
                const tag = tagDeleteBtn.closest('.skill-tag');
                if (tag) tag.remove();
                return;
            }
        });

        // 4. 生成 PDF
        function generatePDF() {
            document.querySelectorAll('.expand-content').forEach(el => {
                el.style.maxHeight = 'none';
                el.classList.add('active');
            });

            const noPdfElements = document.querySelectorAll('.no-pdf');
            noPdfElements.forEach(el => el.style.display = 'none');

            const element = document.getElementById('resume-container');
            const opt = {
                margin:       0,
                filename:     '我的简历.pdf',
                image:        { type: 'jpeg', quality: 0.98 },
                html2canvas:  { scale: 2, useCORS: true, scrollY: 0 },
                jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };

            html2pdf().set(opt).from(element).save().then(() => {
                noPdfElements.forEach(el => el.style.display = '');
                alert("PDF 生成中... 请稍候");
            });
        }
    </script>
</body>
</html>